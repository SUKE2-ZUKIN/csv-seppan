# 共働きコスト折半ツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
マネーフォワードMEのCSVエクスポート機能を活用し、夫婦間での家計支出の折半計算を自動化するWebアプリケーションを開発する。

### 1.2 背景
- 家族代表者（夫または妻）のマネーフォワードMEアカウント1つで家計を一元管理
- 代表者のカードで大部分の支払いを実施
- 片方が個人カードで支払った分については差し引きして折半精算
- マネーフォワードMEの中項目やメモ欄に識別文字列を設定して支払者を判別

## 2. 機能要件

### 2.1 データ入力機能
**2.1.1 CSVファイルアップロード**
- マネーフォワードMEから出力されたCSV形式のファイルを受け付ける
- 対応フォーマット：「収入・支出詳細」形式
- 文字エンコーディング：Shift_JIS対応
- ファイルサイズ制限：10MB以下

**2.1.2 CSVカラム構成**
以下のカラムを含むCSVファイルに対応：
- 計算対象
- 日付
- 内容
- 金額（円）
- 保有金融機関
- 大項目
- 中項目
- メモ
- 振替
- ID

### 2.2 設定機能
**2.2.1 識別カラム選択**
- プルダウンメニューから折半判定に使用するカラムを選択
- 選択可能項目：
  - 中項目（デフォルト）
  - 大項目
  - 内容
  - メモ
  - その他CSVヘッダーに含まれる全カラム

**2.2.2 識別文字列設定**
- 家族代表者の識別文字列設定（例：「夫カード」）
- 配偶者の識別文字列設定（例：「妻カード」）
- 正規表現による柔軟な文字列マッチング対応

**2.2.3 折半比率設定**
- 家族代表者と配偶者の折半比率を指定
- デフォルト：50:50
- カスタム比率設定（例：60:40、70:30など）
- 小数点以下1桁まで対応

### 2.3 計算・集計機能
**2.3.1 支出分類**
各取引を以下に分類：
- 家族代表者の個人支出
- 配偶者の個人支出
- 折半対象外支出（共通支出、収入等）

**2.3.2 折半計算**
- 各人の支出合計額を算出
- 設定された比率に基づく負担額を計算
- 精算金額（差額）を算出
- 誰がいくら支払う/受け取るかを明示

### 2.4 表示・出力機能
**2.4.1 結果表示画面**
- 期間情報（CSVに含まれる日付の範囲）
- 家族代表者の支出合計
- 配偶者の支出合計
- 折半対象支出の合計
- 各人の負担額
- 精算金額と方向性

**2.4.2 詳細内訳表示**
- 取引一覧（日付、内容、金額、分類）
- 分類別集計（食費、日用品等）
- 月別推移（将来拡張）

**2.4.3 エクスポート機能**（将来拡張）
- 結果をCSV形式でダウンロード
- 精算記録の保存

## 3. 非機能要件

### 3.1 技術仕様
**3.1.1 アーキテクチャ**
- フロントエンド：React (TypeScript)
- バックエンド：Go
- 開発環境：Docker
- 実行環境：localhost（開発段階）

**3.1.2 データ保存**
- セッション内でのデータ保持（リフレッシュで消失）
- 将来的にはローカルストレージまたはデータベース対応

### 3.2 パフォーマンス要件
- CSVファイル読み込み：5秒以内
- 計算処理：1秒以内
- UI応答性：即座（500ms以内）

### 3.3 ユーザビリティ要件
- レスポンシブデザイン対応（PC、タブレット、スマートフォン）
- 直感的なUI/UX
- エラーメッセージの分かりやすい表示

## 4. システム制約

### 4.1 技術制約
- ブラウザベースアプリケーション
- インターネット接続不要（ローカル実行）
- 外部サービス連携なし

### 4.2 データ制約
- マネーフォワードMEのCSV形式に依存
- 日本語文字コード（Shift_JIS）対応必須

## 5. 将来拡張機能

### 5.1 履歴管理機能
- 月別の折半履歴保存
- 過去データの参照・比較
- 年間集計レポート

### 5.2 高度な分析機能
- カテゴリ別支出推移グラフ
- 予算設定とアラート機能
- 支出パターン分析

### 5.3 データ連携機能
- マネーフォワードME API連携（将来的に利用可能な場合）
- 他の家計簿アプリとの連携

## 6. 開発スケジュール（想定）

### Phase 1：基本機能開発
- CSVアップロード・解析機能
- 識別・計算機能
- 基本的な結果表示

### Phase 2：UI/UX改善
- レスポンシブデザイン対応
- エラーハンドリング強化
- ユーザビリティ向上

### Phase 3：拡張機能
- 履歴管理
- データエクスポート
- 高度な分析機能

## 7. 成功基準

### 7.1 機能的成功基準
- マネーフォワードMEのCSVファイルを正常に読み込める
- 識別文字列による支出分類が正確に行われる
- 折半計算が設定比率に基づいて正確に実行される
- 結果が分かりやすく表示される

### 7.2 技術的成功基準
- Docker環境で安定して動作する
- エラーなくローカルホストでアクセス可能
- レスポンス時間が要件を満たす

### 7.3 ユーザー体験成功基準
- CSVアップロードから結果表示まで直感的に操作できる
- 計算結果の妥当性が一目で判断できる
- エラー発生時に適切なガイダンスが提供される